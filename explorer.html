<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GraphQL API Explorer</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .explorer-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin: 20px auto;
      max-width: 1200px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    .query-section {
      margin-bottom: 30px;
    }
    
    .query-section h3 {
      color: #4a5568;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }
    
    .query-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      margin: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    .query-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .result-area {
      background: #f7fafc;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 20px;
      margin-top: 15px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }
    
    .schema-section {
      background: #f0fff4;
      border: 1px solid #9ae6b4;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .schema-section h4 {
      color: #22543d;
      margin-bottom: 10px;
    }
    
    .schema-item {
      background: white;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border-left: 3px solid #38a169;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="explorer-container">
      <h2>GraphQL API Explorer</h2>
      <p>Use this tool to explore all available data in the GraphQL API</p>
      
      <!-- Authentication Section -->
      <div class="query-section">
        <h3>üîê Authentication</h3>
        <input type="text" id="jwt-token" placeholder="Enter your JWT token here" style="width: 100%; margin-bottom: 10px;">
        <button class="query-button" onclick="setToken()">Set Token</button>
        <button class="query-button" onclick="clearToken()">Clear Token</button>
      </div>

      <!-- User Data Queries -->
      <div class="query-section">
        <h3>üë§ User Information</h3>
        <button class="query-button" onclick="queryUser()">Get User Info</button>
        <button class="query-button" onclick="queryAllUsers()">Get All Users</button>
        <button class="query-button" onclick="queryUserWithDetails()">Get User with Full Details</button>
        <div id="user-result" class="result-area"></div>
      </div>

      <!-- Transaction Data -->
      <div class="query-section">
        <h3>üí∞ Transactions & XP</h3>
        <button class="query-button" onclick="queryXPTransactions()">Get XP Transactions</button>
        <button class="query-button" onclick="queryAllTransactions()">Get All Transactions</button>
        <button class="query-button" onclick="queryTransactionTypes()">Get Transaction Types</button>
        <div id="transaction-result" class="result-area"></div>
      </div>

      <!-- Results Data -->
      <div class="query-section">
        <h3>üìä Results & Progress</h3>
        <button class="query-button" onclick="queryResults()">Get Results</button>
        <button class="query-button" onclick="queryResultsWithDetails()">Get Results with Details</button>
        <button class="query-button" onclick="queryProgress()">Get Progress</button>
        <div id="results-result" class="result-area"></div>
      </div>

      <!-- Schema Information -->
      <div class="schema-section">
        <h4>üìã Available Data Types</h4>
        <div class="schema-item">
          <strong>User:</strong> id, login, email, attrs, createdAt, updatedAt
        </div>
        <div class="schema-item">
          <strong>Transaction:</strong> id, amount, type, createdAt, path, userId
        </div>
        <div class="schema-item">
          <strong>Result:</strong> id, grade, type, createdAt, userId
        </div>
        <div class="schema-item">
          <strong>Progress:</strong> id, userId, objectId, grade, createdAt
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "https://learn.reboot01.com/api";
    const GRAPHQL_ENDPOINT = API_BASE + "/graphql-engine/v1/graphql";
    let jwtToken = null;

    function setToken() {
      jwtToken = document.getElementById('jwt-token').value;
      if (jwtToken) {
        alert('Token set successfully!');
      }
    }

    function clearToken() {
      jwtToken = null;
      document.getElementById('jwt-token').value = '';
      alert('Token cleared!');
    }

    async function fetchGraphQL(query) {
      try {
        const headers = {
          "Content-Type": "application/json"
        };
        
        if (jwtToken) {
          headers.Authorization = `Bearer ${jwtToken}`;
        }

        const res = await fetch(GRAPHQL_ENDPOINT, {
          method: "POST",
          headers: headers,
          body: JSON.stringify({ query }),
        });

        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }

        return await res.json();
      } catch (e) {
        console.error("GraphQL fetch error:", e);
        return { error: e.message };
      }
    }

    function displayResult(elementId, data) {
      const element = document.getElementById(elementId);
      element.textContent = JSON.stringify(data, null, 2);
    }

    // User Queries
    async function queryUser() {
      const result = await fetchGraphQL(`
        query {
          user {
            id
            login
            email
            attrs
            createdAt
            updatedAt
          }
        }
      `);
      displayResult('user-result', result);
    }

    async function queryAllUsers() {
      const result = await fetchGraphQL(`
        query {
          user(limit: 10) {
            id
            login
            email
            createdAt
          }
        }
      `);
      displayResult('user-result', result);
    }

    async function queryUserWithDetails() {
      const result = await fetchGraphQL(`
        query {
          user {
            id
            login
            email
            attrs
            createdAt
            updatedAt
            transaction {
              id
              amount
              type
              createdAt
              path
            }
            result {
              id
              grade
              type
              createdAt
            }
          }
        }
      `);
      displayResult('user-result', result);
    }

    // Transaction Queries
    async function queryXPTransactions() {
      const result = await fetchGraphQL(`
        query {
          transaction(where: {type: {_eq: "xp"}}, order_by: {createdAt: desc}, limit: 20) {
            id
            amount
            type
            createdAt
            path
            user {
              login
            }
          }
        }
      `);
      displayResult('transaction-result', result);
    }

    async function queryAllTransactions() {
      const result = await fetchGraphQL(`
        query {
          transaction(order_by: {createdAt: desc}, limit: 20) {
            id
            amount
            type
            createdAt
            path
            user {
              login
            }
          }
        }
      `);
      displayResult('transaction-result', result);
    }

    async function queryTransactionTypes() {
      const result = await fetchGraphQL(`
        query {
          transaction(distinct_on: type) {
            type
          }
        }
      `);
      displayResult('transaction-result', result);
    }

    // Results Queries
    async function queryResults() {
      const result = await fetchGraphQL(`
        query {
          result(order_by: {createdAt: desc}, limit: 20) {
            id
            grade
            type
            createdAt
            user {
              login
            }
          }
        }
      `);
      displayResult('results-result', result);
    }

    async function queryResultsWithDetails() {
      const result = await fetchGraphQL(`
        query {
          result(order_by: {createdAt: desc}, limit: 10) {
            id
            grade
            type
            createdAt
            user {
              id
              login
              email
            }
          }
        }
      `);
      displayResult('results-result', result);
    }

    async function queryProgress() {
      const result = await fetchGraphQL(`
        query {
          progress(order_by: {createdAt: desc}, limit: 20) {
            id
            grade
            createdAt
            user {
              login
            }
          }
        }
      `);
      displayResult('results-result', result);
    }

    // Auto-load token from localStorage if available
    window.addEventListener('load', () => {
      const token = localStorage.getItem('jwtToken');
      if (token) {
        document.getElementById('jwt-token').value = token;
        jwtToken = token;
      }
    });

    
  </script>
</body>
</html> 